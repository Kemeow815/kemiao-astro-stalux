---
import { getCollection } from 'astro:content';
import Head from '../../components/Head.vue';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.vue';
import { config_site } from '../../utils/config-adapter';
import '../../../src/styles/global.styl';
import { processFrontmatter } from '../../utils/process-frontmatter';
import '../../styles/pages/tags/index.styl';
// 获取文章集合
const allPosts = await getCollection('posts');
const processedPosts = await Promise.all(allPosts.map(post => processFrontmatter(post)));

// 提取所有标签并计算数量
const tagCounts = processedPosts.reduce((acc, post) => {
  const tags = post.data.tags || [];
  tags.forEach((tag: string) => {
    if (tag.trim()) {
      acc[tag] = (acc[tag] || 0) + 1;
    }
  });
  return acc;
}, {});

// 转换为排序后的数组
const sortedTags = Object.entries(tagCounts)
  .sort(([, countA], [, countB]) => (countB as number) - (countA as number)) // 按数量降序排序
  .map(([tag, count]) => ({ tag, count: count as number }));

// 页面标题
const pageTitle = '标签云 | ' + config_site.title;
---

<!DOCTYPE html>
<html lang={config_site.lang}>
  <Head 
    title={pageTitle}
    description="所有文章标签列表"
    author={config_site.author}
    url={config_site.url + '/tags/'}
    noindex={true}
  >
  </Head>
  <body>
    <script>
      import '../../scripts/background.ts';
    </script>
    <Header />
    <main class="tags-container">
      <div class="page-header">
        <h1 class="page-title">标签云</h1>
        <p class="page-description">探索不同主题的文章标签</p>
      </div>

      <div class="tags-cloud">
        {sortedTags.length > 0 ? (
          sortedTags.map(({ tag, count }) => (
            <a href={`/tags/${tag}`} class="tag-item" data-count={count}>
              <span class="tag-name">{tag}</span>
              <span class="tag-count">{count}</span>
            </a>
          ))
        ) : (
          <div class="no-tags">暂无标签</div>
        )}
      </div>
    </main>
    <Footer />
  </body>
</html>

