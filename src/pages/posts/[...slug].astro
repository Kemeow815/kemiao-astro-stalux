---
import { type CollectionEntry, getCollection } from 'astro:content';
import BlogPost from '../../layouts/BlogPost.astro';
import { render } from 'astro:content';
import { processFrontmatter } from '../../utils/process-frontmatter';

export async function getStaticPaths() {
	const posts = await getCollection('posts');
	const processedPosts = await Promise.all(
		posts.map(async (post) => {
			const processedPost = await processFrontmatter(post);
			return {
				params: { slug: processedPost.data.abbrlink },
				props: processedPost,
			};
		})
	);
	return processedPosts;
}
type Props = CollectionEntry<'posts'>;

const post = Astro.props;
const { Content, headings } = await render(post);
---

<BlogPost {...post.data} headings={headings}>
	<Content />
</BlogPost>
