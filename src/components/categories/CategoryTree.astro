---
import type { CategoryNode, CategoryTreesResult } from './CategoryUtils';
import CategoryNodeComponent from './CategoryNode.astro';
import DeepNestedCategories from './DeepNestedCategories.astro';

interface Props {
  categoriesData: CategoryTreesResult;
  currentPath: string;
}

const { categoriesData, currentPath } = Astro.props;
import '../../styles/components/categories/CategoryTree.styl';
---

<div class="post-categories">
  <span class="categories-label">分类：</span>
  <div class="category-trees-container">
    {/* 显示前3层分类树 */}
    {categoriesData.trees.map((rootCategory) => (
      <div class="category-tree">
        {/* 渲染根分类 (第1层) */}
        <CategoryNodeComponent
          category={rootCategory}
          currentPath={currentPath}
        />
        
        {/* 渲染子分类 (第2层) */}
        {rootCategory.children.length > 0 && (
          <div class="subcategories-container">
            {rootCategory.children.map((child) => (
              <div class="subcategory-branch">
                <CategoryNodeComponent
                  category={child}
                  currentPath={currentPath}
                  isChild={true}
                />
                
                {/* 渲染孙分类 (第3层) */}
                {child.children.length > 0 && (
                  <div class="grandchildren-container">
                    {child.children.map((grandchild) => (
                      <div class="grandchild-branch">
                        <CategoryNodeComponent
                          category={grandchild}
                          currentPath={currentPath}
                          isGrandchild={true}
                        />
                      </div>
                    ))}
                  </div>
                )}
              </div>
            ))}
          </div>
        )}
      </div>
    ))}
    
    {/* 显示深层嵌套分类（第4-9层）作为平铺标签 */}
    {categoriesData.deepNestedCategories.length > 0 && (
      <DeepNestedCategories 
        categories={categoriesData.deepNestedCategories} 
        currentPath={currentPath} 
      />
    )}
  </div>
</div>